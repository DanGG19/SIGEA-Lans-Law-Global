{% extends 'SIGEA_APP/admin/index.html' %}
{% block title %}Actividad{% endblock %}
{% block content %}

<script src='https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@6.1.13/index.global.min.js'></script>

<style>
    .scrollable-content {
        max-height: 70vh; /* Ajusta esta altura según tus necesidades */
        overflow-y: auto;
    }
</style>



<div class="scrollable-content mt-5">
    <h1>Calendario</h1>
    <button class="btn btn-primary" data-toggle="modal" data-target="#createModal">Crear Actividad</button>
    <div id='calendar'></div>
    <!-- Detail Modal -->
    <div class="modal fade" id="createModal" tabindex="-1" aria-labelledby="createModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="createModalLabel">Crear Nueva Actividad</h5>
            <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <!-- formulario -->
            <form id="newActividad">
              <div class="form-group">
                  <label >Nombre de actividad:</label>
                  <input type="text" class="form-control" id="actividadTitle" name="nombreactividad" required>
              </div>
              <div class="form-group">
                  <label >Fecha y hora de realización:</label>
                  <input type="datetime-local" class="form-control" id="actividadStart" name="fechaactividad" required>
              </div>
              <div class="form-group">
                <label >Tipo de actividad:</label>
                <input type="text" class="form-control" id="actividadTipo" name="tipoactividad"></input>
              </div>
              <div class="form-group">
                  <label >Descripción:</label>
                  <textarea class="form-control" id="actividadDescription" name="descripcionactividad" rows="3"></textarea>
              </div>
              <button id="insertaract" type="submit" class="btn btn-primary" data-url="{% url 'actividades_create' %}">Crear Evento</button>
            </form>
          </div>
        </div>
      </div>
    </div>
</div>
<!-- Detail Modal -->
<div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="detailModalLabel">Detalles del Actividad</h5>
        <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="detailForm">
          <div class="form-group">
            <label>Nombre de actividad:</label>
            <input type="text" class="form-control" id="detailTitle" readonly>
          </div>
          <div class="form-group">
            <label>Fecha y hora de realización:</label>
            <input type="datetime-local" class="form-control" id="detailStart" readonly>
          </div>
          <div class="form-group">
            <label >Tipo de actividad:</label>
            <input type="text" class="form-control" id="detailTypeActivity" readonly></input>
          </div>
          <div class="form-group">
            <label>Descripción:</label>+
            <textarea class="form-control" id="detailDescription" rows="3" readonly></textarea>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      timeZone: 'UTC',
      initialView: 'dayGridMonth',
      aspectRatio: 1.5,
      headerToolbar: {
        left: 'prev,next',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay,multiMonthYear'
      },
      selectable: true,
      editable: true,
      dayMaxEvents: true,
      events: '/actividades/list',
      resourceAreaHeaderContent: 'Rooms',

      // Handler for event clicks
      eventClick: function(info) {
        // Prevent the default action
        info.jsEvent.preventDefault();

        // Populate the modal with the event details
        document.getElementById('detailTitle').value = info.event.title;
        document.getElementById('detailStart').value = new Date(info.event.start).toISOString().slice(0,16);
        document.getElementById('detailDescription').value = info.event.extendedProps.description || '';
        document.getElementById('detailTypeActivity').value = info.event.extendedProps.typeact || '';
        // Show the modal
        $('#detailModal').modal('show');
      }
    });

    calendar.on('select', function(info) {
      $('#createModal').modal('show');
    });

    calendar.render();

    //ajax del formulario
  $(document).on('submit', '#newActividad', function (event)  {
    const button = $('#insertaract').data('url');
    event.preventDefault();
    var formData = $(this).serialize();

    console.log(button);

    var eventTitle = document.getElementById('actividadTitle').value;
    var eventStart = new Date(document.getElementById('actividadStart').value).toISOString();
    
      // Agregar el evento al calendario
      calendar.addEvent({
        title: actividadTitle,
        start: actividadStart,
      });
    
    $.ajax({
      url: button,
      type: 'POST',
      data: formData,
      success: function (data) {
          if (data.success) {
            $('#createModal').modal('hide');
            alert(data.message);
            location.reload();
          } else {
              alert(data.errors)
          }
      },
      error: function (xhr, status, error) {
          alert('Error en la solicitud AJAX:');
          alert(xhr.toString());
          alert(status);
          alert(error);
      }
  })
  });
  
});
</script>

{% endblock %}
